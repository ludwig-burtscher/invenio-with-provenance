401,404c401,414
<     # Note, cannot be done in one line due overloading of boolean
<     # operations permission object.
<     if not permission_factory(record=record).can():
<         from flask_login import current_user
---
>     pm = permission_factory(record=record)
> 
>     from flask_login import current_user
>     import subprocess
>     import json
>     class SetEncoder(json.JSONEncoder):
>         def default(self, obj):
>             if isinstance(obj, set):
>                 return list(obj)
>             if isinstance(obj, InstanceState):
>                 return str(obj)
>             return json.JSONEncoder.default(self, obj)
>     subprocess.run(["python3", "/provstore-push.py", json.dumps(vars(current_user), cls=SetEncoder), json.dumps(vars(pm), cls=SetEncoder), json.dumps(vars(record) if record is not None else None, cls=SetEncoder)], shell=True, stdout=open("/tmp/r-out.txt", "a+"), stderr=open("/tmp/r-err.txt", "a+"))
>     if not pm.can():
